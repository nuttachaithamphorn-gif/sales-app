<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>SaleApp</title>
<style>
body { font-family: sans-serif; margin: 20px; }
input, button { margin: 4px; padding: 6px; }
#app { display: none; }
</style>
</head>
<body>

<h2>SaleApp Login</h2>
<div id="login">
  <input id="user" placeholder="Username">
  <input id="pass" placeholder="Password" type="password">
  <button onclick="login()">Login</button>
  <div id="msg"></div>
</div>

<div id="app">
  <h3>บันทึกยอดขาย</h3>
  <input id="customer" placeholder="Customer">
  <input id="amount" placeholder="Amount">
  <button onclick="submitSale()">Submit</button>
  <pre id="output"></pre>
</div>

<script>
const API_BASE = "https://script.google.com/macros/s/AKfycbx-cbSMcIknxPuT5eVKkjePqVQHBnzPOYtgigozgdIKr8N4jAGjn2Cs90o4GYXVyd01Zg/exec";
let token = null;

async function apiPost(data) {
  const params = new URLSearchParams();
  for (const k in data) {
    const v = data[k];
    params.append(k, typeof v === "object" ? JSON.stringify(v) : v);
  }
  const res = await fetch(API_BASE, {
    method: "POST",
    headers: { "Content-Type": "application/x-www-form-urlencoded" },
    body: params
  });
  return await res.json();
}

async function login() {
  const username = user.value;
  const password = pass.value;
  const res = await apiPost({ action: "login", username, password });
  msg.textContent = res.ok ? "เข้าสู่ระบบสำเร็จ" : res.message;
  if (res.ok) {
    token = res.token;
    login.style.display = "none";
    app.style.display = "block";
  }
}

async function submitSale() {
  const customerName = customer.value.trim();
  const amountNum = Number(amount.value);
  const items = [{ customer: customerName, number: 1, amount: amountNum }];
  const res = await apiPost({
    action: "submitSales",
    sheet: "saleThai",
    user: "testuser",
    rows: items
  });
  output.textContent = JSON.stringify(res, null, 2);
}
</script>

</body>
</html>
